(function(){function l(b,a){b.getAttribute("tabindex")||b.setAttribute("tabindex","0");b.addEventListener("keydown",function(c){c=c||window.event;switch(c.keyCode){case 33:a.prevNode(10);break;case 34:a.nextNode(10);break;case 35:a.nextNode(-1);break;case 36:a.prevNode(-1);break;case 37:a.prevNode(1);break;case 38:a.nextSibling(-1);break;case 39:a.nextNode(1);break;case 40:a.nextSibling(1);break;case 46:a.cutCurrent()}33<=c.keyCode&&40>=c.keyCode&&c.preventDefault()})}function f(b,a){var c;try{c=
h.parseSgf(b)}catch(g){return}h.loadSgf(c,a)}function k(b,a,c){var g=new XMLHttpRequest;g.onreadystatechange=function(){4===g.readyState&&200===g.status&&(f(g.responseText,a),n(a,c))};g.overrideMimeType("text/plain");g.open("GET",b,!0);g.send()}function n(b,a){function c(a,c){var d;a=a.split(/\D+/);for(d=0;d<a.length;d++)a[d]&&(c?b.getCurrent().children.length&&(b.nextNode(1),b.nextSibling(a[d]-1)):b.nextNode(+a[d]))}var g,d,e;a=a.split(/[Nn]+/);for(d=0;d<a.length;d++)for(g=a[d].split(/[Bb]+/),c(g[0],
!1),e=1;e<g.length;e++)c(g[e],!0)}var h=window.besogo=window.besogo||{};h.VERSION="0.0.1-alpha";h.create=function(b,a){function c(a,c){var d=document.createElement("div");a&&(d.className=a);c=c||b;c.appendChild(d);return d}var g,d,e,q={control:h.makeControlPanel,comment:h.makeCommentPanel,tool:h.makeToolPanel,tree:h.makeTreePanel,file:h.makeFilePanel},m=b.textContent||b.innerText||"",r;b.className+=" besogo-container";a=a||{};a.size=h.parseSize(a.size||19);a.coord=a.coord||"none";a.tool=a.tool||"auto";
""===a.panels&&(a.panels=[]);a.panels=a.panels||"control comment tool tree file";"string"===typeof a.panels&&(a.panels=a.panels.split(" "));a.path=a.path||"";g=h.makeEditor(a.size.x,a.size.y);g.setTool(a.tool);g.setCoordStyle(a.coord);a.nokeys||l(b,g);if(a.sgf)try{k(a.sgf,g,a.path)}catch(p){}else m.match(/\s*\(\s*;/)&&(f(m,g),n(g,a.path));for("number"!==typeof a.variants&&"string"!==typeof a.variants||g.setVariantStyle(+a.variants);b.firstChild;)b.removeChild(b.firstChild);d=c("besogo-board");h.makeBoardDisplay(d,
g);if(0<a.panels.length)for(e=c("besogo-panels"),m=0;m<a.panels.length;m++)if(r=a.panels[m],q[r])q[r](c("besogo-"+r,e),g);a.noresize||(g=function(){var a=b.parentElement.clientWidth,c=window.innerHeight;600>a||a<c?(b.style["flex-direction"]="column",d.style.height=a+"px",d.style.width=a+"px",e&&(e.style.height=(400<c?c:400)+"px",e.style.width=a+"px")):(b.style["flex-direction"]="row",e&&(c=a-400<c?a-400:c,e.style.height=c+"px",e.style.width=a-c+"px"),d.style.height=c+"px",d.style.width=c+"px")},window.addEventListener("resize",
g),g())};h.parseSize=function(b){var a,c;b=(b+"").replace(/\s/g,"");(a=b.match(/^(\d+):(\d+)$/))?(c=+a[1],b=+a[2]):b.match(/^\d+$/)?(c=+b,b=+b):c=b=19;if(52<c||1>c||52<b||1>b)c=b=19;return{x:c,y:b}};h.autoInit=function(){function b(a,c){return-1!==a.className.split(" ").indexOf(c)}var a=document.getElementsByTagName("div"),c=[],g,d,e;for(g=0;g<a.length;g++)(b(a[g],"besogo-editor")||b(a[g],"besogo-viewer")||b(a[g],"besogo-diagram"))&&!b(a[g],"besogo-container")&&c.push(a[g]);for(g=0;g<c.length;g++){a=
{};b(c[g],"besogo-editor")?(a.panels=["control","comment","tool","tree","file"],a.tool="auto"):b(c[g],"besogo-viewer")?(a.panels=["control","comment"],a.tool="navOnly"):b(c[g],"besogo-diagram")&&(a.panels=[],a.tool="navOnly");e=c[g].attributes;for(d=0;d<e.length;d++)a[e[d].name]=e[d].value;h.create(c[g],a)}}})();
besogo.makeBoardDisplay=function(l,f){function k(){C=!0;z=[];x.removeChild(D);l.removeEventListener("touchstart",k)}function n(d){var e,m,f="";v=("none"===d?0:48)+0;e=2*v+88*u;m=2*v+88*t;x=besogo.svgEl("svg",{width:"100%",height:"100%",viewBox:"0 0 "+e+" "+m});x.appendChild(besogo.svgEl("rect",{width:e,height:m,"class":"besogo-svg-board"}));x.appendChild(besogo.svgEl("rect",{width:88*(u-1),height:88*(t-1),x:p(1),y:p(1),"class":"besogo-svg-lines"}));for(e=2;e<=t-1;e++)f+="M"+p(1)+","+p(e)+"h"+88*(u-
1);for(e=2;e<=u-1;e++)f+="M"+p(e)+","+p(1)+"v"+88*(t-1);x.appendChild(besogo.svgEl("path",{d:f,"class":"besogo-svg-lines"}));b();"none"!==d&&h(d);y=besogo.svgEl("g");A=besogo.svgEl("g");x.appendChild(y);x.appendChild(A);C||(D=besogo.svgEl("g"),x.appendChild(D));for(f=1;f<=u;f++)for(e=1;e<=t;e++)d=besogo.svgEl("rect",{x:p(f)-44,y:p(e)-44,width:88,height:88,opacity:0}),d.addEventListener("click",a(f,e)),C||(d.addEventListener("mouseover",c(f,e)),d.addEventListener("mouseout",g(f,e))),x.appendChild(d)}
function h(a){function c(a,d,b){a=besogo.svgEl("text",{x:a,y:d,dy:".65ex","font-size":32,"text-anchor":"middle","font-family":"Helvetica, Arial, sans-serif",fill:"black"});a.appendChild(document.createTextNode(b));x.appendChild(a)}a=besogo.coord[a](u,t);var d,b;for(d=1;d<=u;d++)b=p(d),c(b,p(1)-66,a.x[d]),c(b,p(t)+66,a.x[d]);for(d=1;d<=t;d++)b=p(d),c(p(1)-66,b,a.y[d]),c(p(u)+66,b,a.y[d])}function b(){function a(c,d){b+="M"+p(c)+","+p(d)+"l0,0"}var c,d,b="";u%2&&t%2&&(c=(u-1)/2+1,d=(t-1)/2+1,a(c,d),
17<=u&&17<=t&&(a(4,d),a(u-3,d),a(c,4),a(c,t-3)));11<=u&&11<=t?(a(4,4),a(4,t-3),a(u-3,4),a(u-3,t-3)):8<=u&&8<=t&&(a(3,3),a(3,t-2),a(u-2,3),a(u-2,t-2));b&&x.appendChild(besogo.svgEl("path",{d:b,"stroke-linecap":"round","class":"besogo-svg-hoshi"}))}function a(a,d){return function(b){f.click(a,d,b.ctrlKey,b.shiftKey);C||c(a,d)()}}function c(a,d){return function(){var c=z[w(a,d)];c&&c.setAttribute("visibility","visible")}}function g(a,d){return function(){var c=z[w(a,d)];c&&c.setAttribute("visibility",
"hidden")}}function d(a){var d=besogo.svgEl("g"),c,b,e,g,m;for(c=1;c<=u;c++)for(b=1;b<=t;b++)if(m=a.getStone(c,b))e=p(c),g=p(b),d.appendChild(besogo.svgStone(e,g,m));x.replaceChild(d,y);y=d}function e(a){var c,d,b,e,g,k=besogo.svgEl("g"),h=a.move,n=f.getVariants(),l,r,y;B=[];for(d=1;d<=u;d++)for(b=1;b<=t;b++)if(l=a.getMarkup(d,b)){e=p(d);g=p(b);r=a.getStone(d,b);y=-1===r?"white":"black";h&&h.x===d&&h.y===b?y=m(n,a,d,b)?besogo.PURP:besogo.BLUE:m(n,a,d,b)&&(y=besogo.RED);if("number"===typeof l)switch(l){case 1:c=
besogo.svgCircle(e,g,y);break;case 2:c=besogo.svgSquare(e,g,y);break;case 3:c=besogo.svgTriangle(e,g,y);break;case 4:c=besogo.svgCross(e,g,y);break;case 5:c=besogo.svgBlock(e,g,y)}else r||(c=q(e,g),k.appendChild(c)),c=besogo.svgLabel(e,g,y,l);k.appendChild(c);B[w(d,b)]=c}h&&0!==h.x&&0!==h.y&&(d=h.x,b=h.y,B[w(d,b)]||(y=m(n,a,d,b)?besogo.PURP:besogo.BLUE,c=besogo.svgPlus(p(d),p(b),y),k.appendChild(c),B[w(d,b)]=c));for(d=0;d<n.length;d++)n[d]!==a&&(c=n[d].move)&&0!==c.x&&!B[w(c.x,c.y)]&&(g=a.getStone(c.x,
c.y),b=p(c.x),e=p(c.y),g||(g=q(b,e),k.appendChild(g)),g=String.fromCharCode(65+d%26),g=besogo.svgLabel(b,e,besogo.LRED,g),k.appendChild(g),B[w(c.x,c.y)]=g);x.replaceChild(k,A);A=k}function q(a,c){return besogo.svgEl("rect",{x:a-44,y:c-44,height:88,width:88,opacity:.85,stroke:"none","class":"besogo-svg-board"})}function m(a,c,d,b){var e,g;for(e=0;e<a.length;e++)if(a[e]!==c&&(g=a[e].move)&&g.x===d&&g.y===b)return!0;return!1}function r(a){if(!C){var c,d,b,e,g,m=besogo.svgEl("g"),q=f.getTool(),h,k;z=
[];m.setAttribute("opacity","0.35");if("navOnly"===q)for(a=a.children,d=0;d<a.length;d++)(h=a[d].move)&&0!==h.x&&(e=p(h.x),g=p(h.y),c=besogo.svgStone(e,g,h.color),c.setAttribute("visibility","hidden"),m.appendChild(c),z[w(h.x,h.y)]=c);else for(d=1;d<=u;d++)for(b=1;b<=t;b++){c=null;e=p(d);g=p(b);h=a.getStone(d,b);k=-1===h?"white":"black";switch(q){case "auto":c=besogo.svgStone(e,g,a.nextToMove);break;case "playB":c=besogo.svgStone(e,g,-1);break;case "playW":c=besogo.svgStone(e,g,1);break;case "addB":-1===
h?c=besogo.svgCross(e,g,besogo.RED):(c=besogo.svgEl("g"),c.appendChild(besogo.svgStone(e,g,-1)),c.appendChild(besogo.svgPlus(e,g,besogo.RED)));break;case "addW":1===h?c=besogo.svgCross(e,g,besogo.RED):(c=besogo.svgEl("g"),c.appendChild(besogo.svgStone(e,g,1)),c.appendChild(besogo.svgPlus(e,g,besogo.RED)));break;case "addE":h&&(c=besogo.svgCross(e,g,besogo.RED));break;case "circle":c=besogo.svgCircle(e,g,k);break;case "square":c=besogo.svgSquare(e,g,k);break;case "triangle":c=besogo.svgTriangle(e,
g,k);break;case "cross":c=besogo.svgCross(e,g,k);break;case "block":c=besogo.svgBlock(e,g,k);break;case "label":c=besogo.svgLabel(e,g,k,f.getLabel())}c&&(c.setAttribute("visibility","hidden"),m.appendChild(c),z[w(d,b)]=c)}x.replaceChild(m,D);D=m}}function p(a){return v+44+88*(a-1)}function w(a,c){return(a-1)*t+(c-1)}var v,u=f.getCurrent().getSize().x,t=f.getCurrent().getSize().y,x,y,A,D,B,z,C=!1;n(f.getCoordStyle());l.appendChild(x);f.addListener(function(a){var c=f.getCurrent(),b=c.getSize(),g=!1,
m=x;if(b.x!==u||b.y!==t||a.coord)u=b.x,t=b.y,n(a.coord||f.getCoordStyle()),l.replaceChild(x,m),g=!0;g||a.navChange||a.stoneChange?(d(c),e(c),r(c)):a.markupChange?(e(c),r(c)):(a.tool||a.label)&&r(c)});(function(a){d(a);e(a);r(a)})(f.getCurrent());l.addEventListener("touchstart",k)};
besogo.makeCommentPanel=function(l,f){function k(a){var c;a.navChange?(c=f.getCurrent().comment||"",h(r,c,"C"),f.getCurrent()===f.getRoot()&&q.firstChild&&"none"===m.style.display?q.style.display="table":q.style.display="none",p.style.display="none",r.style.display="block"):void 0!==a.comment&&(h(r,a.comment,"C"),p.value=a.comment);if(a.gameInfo){c=(a.gameInfo.PW||"White")+" ";h(g,c,"PW");c="("+(a.gameInfo.WR||"?")+")";h(g,c,"WR");c=(a.gameInfo.WT?" "+a.gameInfo.WT:"")+"\n";h(g,c,"WT");c=(a.gameInfo.PB||
"Black")+" ";h(d,c,"PB");c="("+(a.gameInfo.BR||"?")+")";h(d,c,"BR");c=(a.gameInfo.BT?" "+a.gameInfo.BT:"")+"\n";h(d,c,"BT");c=a.gameInfo;var b=document.createElement("table"),k,l,w,z;b.className="besogo-gameInfo";for(k=0;k<v.length;k++)l=v[k],c[l]&&(w=document.createElement("tr"),b.appendChild(w),z=document.createElement("td"),z.appendChild(document.createTextNode(u[l])),w.appendChild(z),z=document.createElement("td"),l=document.createTextNode(c[l]),z.appendChild(l),w.appendChild(z));b.firstChild&&
"none"!==q.style.display||(b.style.display="none");e.replaceChild(b,q);q=b;n(a.gameInfo)}if(a.navChange||a.stoneChange)h(g,f.getCurrent().whiteCaps+" captures","wCaps"),h(d,f.getCurrent().blackCaps+" captures","bCaps")}function n(a){var c=document.createElement("table"),d=w.concat(v),b,g,p,h,k;c.className="besogo-gameInfo";for(b=0;b<d.length;b++)g=d[b],p=document.createElement("tr"),c.appendChild(p),h=document.createElement("td"),h.appendChild(document.createTextNode(u[g])),p.appendChild(h),h=document.createElement("td"),
k=document.createElement("input"),a[g]&&(k.value=a[g]),k.onblur=function(a,c){return function(){f.setGameInfo(a.value,c)}}(k,g),k.addEventListener("keydown",function(a){a=a||window.event;a.stopPropagation()}),h.appendChild(k),p.appendChild(h);"none"===m.style.display&&(c.style.display="none");e.replaceChild(c,m);m=c}function h(c,d,b){d=document.createTextNode(d);c.replaceChild(d,a[b]);a[b]=d}function b(c,d,b){b.className="besogo-"+d+"Info";for(d=0;d<c.length;d++)a[c[d]]=document.createTextNode(""),
b.appendChild(a[c[d]]);return b}var a={},c=document.createElement("div"),g=document.createElement("div"),d=document.createElement("div"),e=document.createElement("div"),q=document.createElement("table"),m=document.createElement("table"),r=document.createElement("div"),p=document.createElement("textarea"),w="PW WR WT PB BR BT".split(" "),v="HA KM RU TM OT GN EV PC RO DT RE ON GC AN US SO CP".split(" "),u={PW:"White Player",WR:"White Rank",WT:"White Team",PB:"Black Player",BR:"Black Rank",BT:"Black Team",
HA:"Handicap",KM:"Komi",RU:"Rules",TM:"Timing",OT:"Overtime",GN:"Game Name",EV:"Event",PC:"Place",RO:"Round",DT:"Date",RE:"Result",ON:"Opening",GC:"Comments",AN:"Annotator",US:"Recorder",SO:"Source",CP:"Copyright"};c.className="besogo-playerInfo";l.appendChild(c);c.appendChild(b(["PW","WR","WT","wCaps"],"white",g));c.appendChild(b(["PB","BR","BT","bCaps"],"black",d));e.className="besogo-commentText";l.appendChild(e);e.appendChild(function(){var a=document.createElement("input");a.type="button";a.value=
"Info";a.title="Show/hide game info";a.onclick=function(){q.style.display="none"===q.style.display&&q.firstChild?"table":"none";m.style.display="none"};return a}());e.appendChild(function(){var a=document.createElement("input");a.type="button";a.value="Edit Info";a.title="Edit game info";a.onclick=function(){m.style.display="none"===m.style.display?"table":"none";q.style.display="none"};return a}());e.appendChild(function(){var a=document.createElement("input");a.type="button";a.value="Comment";a.title=
"Edit comment";a.onclick=function(){"none"===p.style.display?(r.style.display="none",q.style.display="none",p.value=f.getCurrent().comment,p.style.display="block"):(p.style.display="none",r.style.display="block")};return a}());e.appendChild(q);e.appendChild(m);a.C=document.createTextNode("");e.appendChild(r);r.appendChild(a.C);e.appendChild(p);p.onblur=function(){f.setComment(p.value)};p.addEventListener("keydown",function(a){a=a||window.event;a.stopPropagation()});f.addListener(k);k({navChange:!0,
gameInfo:f.getGameInfo()});m.style.display="none"};
besogo.makeControlPanel=function(l,f){function k(m){function k(a){a%2?(d.setAttribute("fill","black"),e.setAttribute("fill",besogo.BLUE),c.title="Variants: child/[sibling]"):(d.setAttribute("fill",besogo.BLUE),e.setAttribute("fill",besogo.RED),c.title="Variants: [child]/sibling");2<=a?(q.setAttribute("visibility","visible"),g.title="Variants: show/[hide]"):(q.setAttribute("visibility","hidden"),g.title="Variants: [show]/hide")}function p(a,c){var d;for(d=0;d<a.length;d++)a[d].setAttribute("fill",
c)}void 0!==m.variantStyle&&k(m.variantStyle);if(m.navChange||m.treeChange)m=f.getCurrent(),m.parent?(p(h,"black"),1<m.parent.children.length?p(a,"black"):p(a,besogo.GREY)):(p(h,besogo.GREY),p(a,besogo.GREY)),m.children.length?p(b,"black"):p(b,besogo.GREY)}function n(){return besogo.svgEl("svg",{width:"100%",height:"100%",viewBox:"0 0 100 100"})}var h=[],b=[],a=[],c,g,d,e,q;(function(){function c(a,d,b){var e=document.createElement("button"),g=n();d=besogo.svgEl("polygon",{points:d,stroke:"none",
fill:"black"});e.title=a;e.onclick=b;e.appendChild(g);g.appendChild(d);l.appendChild(e);return d}h.push(c("First node","5,10 5,90 25,90 25,50 95,90 95,10 25,50 25,10",function(){f.prevNode(-1)}));h.push(c("Jump back","95,10 50,50 50,10 5,50 50,90 50,50 95,90",function(){f.prevNode(10)}));h.push(c("Previous node","85,10 85,90 15,50",function(){f.prevNode(1)}));b.push(c("Next node","15,10 15,90 85,50",function(){f.nextNode(1)}));b.push(c("Jump forward","5,10 50,50 50,10 95,50 50,90 50,50 5,90",function(){f.nextNode(10)}));
b.push(c("Last node","95,10 95,90 75,90 75,50 5,90 5,10 75,50 75,10",function(){f.nextNode(-1)}));a.push(c("Previous sibling","10,85 90,85 50,15",function(){f.nextSibling(-1)}));a.push(c("Next sibling","10,15 90,15 50,85",function(){f.nextSibling(1)}))})();(function(){var a,b;c=document.createElement("button");c.onclick=function(){f.toggleVariantStyle(!1)};l.appendChild(c);a=n();c.appendChild(a);b=besogo.svgEl("path",{d:"m75,25h-50l50,50",stroke:"black","stroke-width":5,fill:"none"});a.appendChild(b);
d=besogo.svgEl("circle",{cx:25,cy:25,r:20,stroke:"none"});a.appendChild(d);e=besogo.svgEl("circle",{cx:75,cy:25,r:20,stroke:"none"});a.appendChild(e);b=besogo.svgEl("circle",{cx:75,cy:75,r:20,fill:besogo.RED,stroke:"none"});a.appendChild(b);g=document.createElement("button");g.onclick=function(){f.toggleVariantStyle(!0)};l.appendChild(g);a=n();g.appendChild(a);a.appendChild(besogo.svgLabel(50,50,besogo.RED,"A"));q=besogo.svgCross(50,50,"black");a.appendChild(q);b=document.createElement("button");
b.onclick=function(){f.toggleCoordStyle()};b.title="Toggle coordinates";l.appendChild(b);a=n();b.appendChild(a);a.appendChild(besogo.svgLabel(50,50,"black","\u56db4"))})();f.addListener(k);k({navChange:!0,variantStyle:f.getVariantStyle()})};
(function(){function l(k){return"ABCDEFGHJKLMNOPQRSTUVWXYZ".charAt((k-1)%25)}function f(k){var f="";20<=k?f="\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".charAt(k/10-1)+"\u5341":10<=k&&(f="\u5341");k%10&&(f+="\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d".charAt((k-1)%10));return f}besogo.coord={};besogo.coord.none=function(k,f){return!1};besogo.coord.western=function(k,f){var h={x:[],y:[]},b;for(b=1;b<=k;b++)h.x[b]=l(b);for(b=1;b<=f;b++)h.y[b]=f-b+1+"";return h};besogo.coord.numeric=
function(f,l){var h={x:[],y:[]},b;for(b=1;b<=f;b++)h.x[b]=b+"";for(b=1;b<=l;b++)h.y[b]=b+"";return h};besogo.coord.corner=function(f,n){var h={x:[],y:[]},b;for(b=1;b<=f;b++)h.x[b]=b<f/2+1?l(b):f-b+1+"";for(b=1;b<=n;b++)h.y[b]=n-b+1+"",h.y[b]=b>n/2?l(n-b+1):b+"";return h};besogo.coord.eastcor=function(k,l){var h={x:[],y:[]},b;for(b=1;b<=k;b++)h.x[b]=b<k/2+1?f(b):k-b+1+"";for(b=1;b<=l;b++)h.y[b]=l-b+1+"",h.y[b]=b>l/2?f(l-b+1):b+"";return h};besogo.coord.eastern=function(k,l){var h={x:[],y:[]},b;for(b=
1;b<=k;b++)h.x[b]=b+"";for(b=1;b<=l;b++)h.y[b]=f(b);return h}})();
besogo.makeEditor=function(l,f){function k(a){"string"===typeof a&&(r=(a=a.replace(/\s/g," ").trim())||"1",m="label",c({tool:m,label:r}))}function n(a,b,e){var g,f=d.children;for(e=0;e<f.length;e++)if((g=f[e].move)&&g.x===a&&g.y===b)return d=f[e],c({navChange:!0}),!0;return!1}function h(a,b,e,g){var f;d.isMutable("move")&&d.parent?d.playMove(a,b,e,g)&&c({stoneChange:!0}):(f=d.makeChild(),f.playMove(a,b,e,g)&&(d.addChild(f),d=f,c({treeChange:!0,navChange:!0,stoneChange:!0})))}function b(a,b,e){var g;
if(e===d.getStone(a,b))if(0!==e)e=0;else return;d.isMutable("setup")?d.placeSetup(a,b,e)&&c({stoneChange:!0}):(g=d.makeChild(),g.placeSetup(a,b,e)&&(d.addChild(g),d=g,c({treeChange:!0,navChange:!0,stoneChange:!0})))}function a(a,b,e){if(e===d.getMarkup(a,b))if(0!==e)e=0;else return;d.addMarkup(a,b,e)&&("string"===typeof e&&(/^-?\d+$/.test(e)?k(""+(+e+1)):/[A-Za-z]$/.test(e)&&(a=e.charAt(e.length-1),a="z"===a?"A":"Z"===a?"a":String.fromCharCode(a.charCodeAt()+1),k(e.slice(0,e.length-1)+a))),c({markupChange:!0}))}
function c(a,c){var d;!c&&a.navChange&&(p=[]);for(d=0;d<e.length;d++)e[d](a)}var g=besogo.makeGameRoot(l,f),d=g,e=[],q="navOnly auto playB playW addB addW addE clrMark circle square triangle cross block label".split(" "),m="auto",r="1",p=[],w={},v="none numeric western eastern corner eastcor".split(" "),u="none",t=0;return{addListener:function(a){e.push(a)},click:function(c,d,e,g){switch(m){case "navOnly":n(c,d,g);break;case "auto":n(c,d,g)||g||h(c,d,0,e);break;case "playB":h(c,d,-1,e);break;case "playW":h(c,
d,1,e);break;case "addB":b(c,d,-1);break;case "addW":b(c,d,1);break;case "addE":b(c,d,0);break;case "clrMark":a(c,d,0);break;case "circle":a(c,d,1);break;case "square":a(c,d,2);break;case "triangle":a(c,d,3);break;case "cross":a(c,d,4);break;case "block":a(c,d,5);break;case "label":a(c,d,r)}},nextNode:function(a){if(0===d.children.length)return!1;for(;0<d.children.length&&0!==a;)d=p.length?p.pop():d.children[0],a--;c({navChange:!0},!0)},prevNode:function(a){if(null===d.parent)return!1;for(;d.parent&&
0!==a;)p.push(d),d=d.parent,a--;c({navChange:!0},!0)},nextSibling:function(a){var b,e=0;d.parent&&(b=d.parent.children,1!==b.length&&(e=b.indexOf(d),e=(e+a)%b.length,0>e&&(e+=b.length),d=b[e],c({navChange:!0})))},toggleCoordStyle:function(){u=v[(v.indexOf(u)+1)%v.length];c({coord:u})},getCoordStyle:function(){return u},setCoordStyle:function(a){besogo.coord[a]&&(u=a,c({coord:a}))},toggleVariantStyle:function(a){var d=t%2,b=t-d;a?b=(b+2)%4:d=(d+1)%2;t=d+b;c({variantStyle:t,markupChange:!0})},getVariantStyle:function(){return t},
setVariantStyle:function(a){if(0===a||1===a||2===a||3===a)t=a,c({variantStyle:t,markupChange:!0})},getGameInfo:function(){return w},setGameInfo:function(a,d){d?w[d]=a:w=a;c({gameInfo:w})},setComment:function(a){a=a.trim();a=a.replace(/\r\n/g,"\n").replace(/\n\r/g,"\n").replace(/\r/g,"\n");a.replace(/\f\t\v\u0085\u00a0/g," ");d.comment=a;c({comment:a})},getTool:function(){return m},setTool:function(a){return"label"===a&&a===m?(/^-?\d+$/.test(r)?k("A"):k("1"),!0):-1!==q.indexOf(a)&&m!==a?(m=a,c({tool:m,
label:r}),!0):!1},getLabel:function(){return r},setLabel:k,getVariants:function(){return 2<=t?[]:1===t?d.parent?d.parent.children:[]:d.children},getCurrent:function(){return d},setCurrent:function(a){d!==a&&(d=a,c({navChange:!0}))},cutCurrent:function(){var a=d.parent;"navOnly"!==m&&a&&!0===confirm("Delete this branch?")&&(a.removeChild(d),d=a,c({treeChange:!0,navChange:!0}))},getRoot:function(){return g},loadRoot:function(a){d=g=a;c({treeChange:!0,navChange:!0,stoneChange:!0})}}};
besogo.makeFilePanel=function(l,f){function k(a){var b=document.createElement("input");b.type="button";b.value=a+"x"+a;"?"===a?(b.title="New custom size board",b.onclick=function(){var a=prompt("Enter custom size for new board\nEverything not saved will be lost","19:19");a&&(a=besogo.parseSize(a),f.loadRoot(besogo.makeGameRoot(a.x,a.y)),f.setGameInfo({}))}):(b.title="New "+a+"x"+a+" board",b.onclick=function(){confirm(b.title+"?\nEverything not saved will be lost")&&(f.loadRoot(besogo.makeGameRoot(a,
a)),f.setGameInfo({}))});l.appendChild(b)}function n(){var a=document.createElement("input");a.type="file";a.style.display="none";a.onchange=h;return a}function h(a){a=a.target.files[0];var g=new FileReader,d=n();l.replaceChild(d,b);b=d;g.onload=function(a){var c;try{c=besogo.parseSgf(a.target.result)}catch(d){alert("SGF parse error at "+d.at+":\n"+d.message);return}besogo.loadSgf(c,f)};confirm("Load '"+a.name+"'?\nEverything not saved will be lost")&&g.readAsText(a)}var b,a;k(9);k(13);k(19);k("?");
b=n();l.appendChild(b);a=document.createElement("input");a.type="button";a.value="Open";a.title="Import SGF";a.onclick=function(){b.click()};l.appendChild(a);a=document.createElement("input");a.type="button";a.value="Save";a.title="Export SGF";a.onclick=function(){var a=prompt("Save file as","export.sgf");if(a){var b=besogo.composeSgf(f),d=document.createElement("a"),b=new Blob([b],{encoding:"UTF-8",type:"text/plain;charset=UTF-8"});d.download=a;d.href=URL.createObjectURL(b);d.style.display="none";
l.appendChild(d);d.click();l.removeChild(d)}};l.appendChild(a)};
besogo.makeGameRoot=function(l,f){function k(a,c){a.parent=c;a.children=[];a.move=null;a.setupStones=[];a.markup=[];a.comment=""}function n(a,c,b,d,e){var f=[];if(!h(a,c,b,d,f))for(c=0;c<f.length;c++)a["board"+f[c].x+"-"+f[c].y]=0,e.push(f[c])}function h(a,c,b,d,e){var k;if(1>c||1>b||c>l||b>f||a.getStone(c,b)===d)return!1;if(!a.getStone(c,b))return!0;for(k=0;k<e.length;k++)if(e[k].x===c&&e[k].y===b)return!1;e.push({x:c,y:b});return h(a,c-1,b,d,e)||h(a,c+1,b,d,e)||h(a,c,b-1,d,e)||h(a,c,b+1,d,e)?!0:
!1}var b={nextToMove:-1,blackCaps:0,whiteCaps:0,moveNumber:0};k(b,null);b.playMove=function(a,c,b,d){var e=0,k=!1,h,r,p;if(!this.isMutable("move"))return!1;b||(b=this.nextToMove);if(1>a||1>c||a>l||c>f)return this.move={x:0,y:0,color:b,captures:0,overwrite:!1},this.nextToMove=-b,this.moveNumber++,!0;if(this.getStone(a,c)){if(!d)return!1;k=!0}r=Object.create(this);p=[];r["board"+a+"-"+c]=b;n(r,a-1,c,b,p);n(r,a+1,c,b,p);n(r,a,c-1,b,p);n(r,a,c+1,b,p);e=p.length;h=this.parent?this.parent.move:null;if(!d&&
h&&h.color===-b&&!1===h.overwrite&&1===h.captures&&1===e&&!r.getStone(h.x,h.y)||0===e&&(n(r,a,c,-b,p),e=-p.length,0>e&&!d))return!1;0>b*e?this.blackCaps+=Math.abs(e):this.whiteCaps+=Math.abs(e);this["board"+a+"-"+c]=b;for(d=0;d<p.length;d++)this["board"+p[d].x+"-"+p[d].y]=0;this.move={x:a,y:c,color:b,captures:e,overwrite:k};this.nextToMove=-b;this.moveNumber++;return!0};b.placeSetup=function(a,c,b){var d=this.parent&&this.parent.getStone(a,c)||0;if(1>a||1>c||a>l||c>f||!this.isMutable("setup")||this.getStone(a,
c)===b)return!1;this["board"+a+"-"+c]=b;this.setupStones[(a-1)*f+(c-1)]=b-d;return!0};b.addMarkup=function(a,b,g){if(1>a||1>b||a>l||b>f||this.getMarkup(a,b)===g)return!1;this.markup[(a-1)*f+(b-1)]=g;return!0};b.getStone=function(a,b){return this["board"+a+"-"+b]||0};b.getSetup=function(a,b){if(this.setupStones[(a-1)*f+(b-1)])switch(this.getStone(a,b)){case 0:return"AE";case -1:return"AB";case 1:return"AW"}else return!1};b.getMarkup=function(a,b){return this.markup[(a-1)*f+(b-1)]||0};b.getType=function(){var a;
if(this.move)return"move";for(a=0;a<this.setupStones.length;a++)if(this.setupStones[a])return"setup";return"empty"};b.isMutable=function(a){return"move"===a&&"empty"===this.getType()&&0===this.children.length||"setup"===a&&"move"!==this.getType()&&0===this.children.length?!0:!1};b.getSiblings=function(){return this.parent&&this.parent.children||[]};b.makeChild=function(){var a=Object.create(this);k(a,this);return a};b.addChild=function(a){this.children.push(a)};b.removeChild=function(a){a=this.children.indexOf(a);
return-1!==a?(this.children.splice(a,1),!0):!1};b.getSize=function(){return{x:l,y:f}};return b};
besogo.loadSgf=function(l,f){function k(a,b){var c,f;for(c=0;c<a.props.length;c++){f=b;var m=a.props[c],l=void 0;switch(m.id){case "B":l=h(m.values[0]);f.playMove(l.x,l.y,-1,!0);break;case "W":l=h(m.values[0]);f.playMove(l.x,l.y,1,!0);break;case "AB":n(m.values,f,"placeSetup",-1);break;case "AW":n(m.values,f,"placeSetup",1);break;case "AE":n(m.values,f,"placeSetup",0);break;case "CR":n(m.values,f,"addMarkup",1);break;case "SQ":n(m.values,f,"addMarkup",2);break;case "TR":n(m.values,f,"addMarkup",3);
break;case "M":case "MA":n(m.values,f,"addMarkup",4);break;case "SL":n(m.values,f,"addMarkup",5);break;case "L":case "LB":n(m.values,f,"addMarkup","label");break;case "C":f.comment=f.comment?f.comment+("\n"+m.values.join().trim()):m.values.join().trim()}}for(c=0;c<a.children.length;c++)f=b.makeChild(),b.addChild(f),k(a.children[c],f)}function n(a,b,c,f){var k,l,p,n,v;for(k=0;k<a.length;k++)if(n=h(a[k].slice(0,2)),"label"===f)l=a[k].slice(3).replace(/\n/g," "),b[c](n.x,n.y,l);else if(":"===a[k].charAt(2))if(v=
h(a[k].slice(3)),v.x===n.x&&v.y===n.y)b[c](n.x,n.y,f);else if(v.x<n.x||v.y<n.y)b[c](n.x,n.y,f),b[c](v.x,v.y,f);else for(l=n.x;l<=v.x;l++)for(p=n.y;p<=v.y;p++)b[c](l,p,f);else b[c](n.x,n.y,f)}function h(a){return a.match(/^[A-Za-z]{2}$/)?{x:b(a.charAt(0)),y:b(a.charAt(1))}:{x:0,y:0}}function b(a){return a.match(/[A-Z]/)?a.charCodeAt(0)-65+27:a.charCodeAt(0)-97+1}var a={x:19,y:19},c;(function(b){var c="PB BR BT PW WR WT HA KM RU TM OT DT EV GN PC RO GC ON RE AN CP SO US".split(" "),e={},k,h,l;for(k=
0;k<b.props.length;k++)h=b.props[k].id,l=b.props[k].values.join().trim(),"SZ"===h?a=besogo.parseSize(l):"ST"===h?f.setVariantStyle(+l):-1!==c.indexOf(h)&&("GC"!==h&&(l=l.replace(/\n/g," ")),l&&(e[h]=l));f.setGameInfo(e)})(l);c=besogo.makeGameRoot(a.x,a.y);k(l,c);f.loadRoot(c)};
besogo.parseSgf=function(l){function f(a){throw{name:"Syntax Error",message:a,at:g,text:l};}function k(a){a&&a!==d&&f("Expected '"+a+"' instead of '"+d+"'");g++;return d=l.charAt(g)}function n(){for(;d&&" ">=d;)k()}function h(){return"\n"===d?("\r"===l.charAt(g+1)&&k(),!0):"\r"===d?("\n"===l.charAt(g+1)&&k(),!0):!1}function b(){var c,g,h;k("(");n();";"!==d&&f("Sub-tree missing root");c=a();n();for(g=c;";"===d;)h=a(),g.children.push(h),g=h,n();for(;"("===d;)h=b(),g.children.push(h),n();k(")");return c}
function a(){var a,b={props:[],children:[]};k(";");for(n();d&&";"!==d&&"("!==d&&")"!==d;){for(a={id:"",values:[]};d&&/[A-Za-z]/.test(d);)/[A-Z]/.test(d)&&(a.id+=d),k();a.id||f("Missing property ID");for(n();"["===d;)a.values.push(c()),n();0===a.values.length&&f("Missing property values");b.props.push(a);n()}return b}function c(){var a="";for(k("[");d&&"]"!==d;)"\\"===d?(k("\\"),h()||(a=" ">=d?a+" ":a+d)):a=h()?a+"\n":" ">=d?a+" ":a+d,k();k("]");return a}for(var g=0,d=l.charAt(g);d&&"("!==d;)k();return b()};
besogo.composeSgf=function(l){function f(a){var b=";",g=a.children;if(!a.parent){var d="FF[4]GM[1]CA[UTF-8]AP[besogo:"+besogo.VERSION+"]",e=a.getSize().x,q=a.getSize().y,m=l.getGameInfo(),r=!1,p,d=(e===q?d+("SZ["+e+"]"):d+("SZ["+e+":"+q+"]"))+("ST["+l.getVariantStyle()+"]\n");for(p in m)m.hasOwnProperty(p)&&m[p]&&(d+=p+"["+n(m[p])+"]",r=!0);d+=r?"\n":"";b+=d}p=b;b="";if("move"===a.getType())e=a.move,b+=1===e.color?"W":"B",b+="["+h(e.x,e.y)+"]";else if("setup"===a.getType()){d={AB:[],AW:[],AE:[]};
for(q=1;q<=a.getSize().x;q++)for(m=1;m<=a.getSize().y;m++)(e=a.getSetup(q,m))&&d[e].push({x:q,y:m});b+=k(d)}d={CR:[],SQ:[],TR:[],MA:[],SL:[],LB:[]};for(q=1;q<=a.getSize().x;q++)for(m=1;m<=a.getSize().y;m++)if(e=a.getMarkup(q,m))"string"===typeof e?d.LB.push({x:q,y:m,label:e}):(e=["CR","SQ","TR","MA","SL"][e-1],d[e].push({x:q,y:m}));b+=k(d);a.comment&&(b=b+(b?"\n":"")+("C["+n(a.comment)+"]"));b=p+b;if(1===g.length)b+="\n"+f(g[0]);else if(1<g.length)for(a=0;a<g.length;a++)b+="\n("+f(g[a])+")";return b}
function k(a){var b="",f,d,e;for(f in a)if(a.hasOwnProperty(f)&&(d=a[f],0<d.length))for(b+=f,e=0;e<d.length;e++)b+="["+h(d[e].x,d[e].y),d[e].label&&(b+=":"+n(d[e].label)),b+="]";return b}function n(a){a=a.replace(/\\/g,"\\\\");return a.replace(/\]/g,"\\]")}function h(a,c){return 0===a||0===c?"":b(a)+b(c)}function b(a){return 26<a?String.fromCharCode(65+a-27):String.fromCharCode(97+a-1)}return"("+f(l.getRoot())+")"};
(function(){besogo.RED="#be0119";besogo.LRED="#ff474c";besogo.BLUE="#0165fc";besogo.PURP="#9a0eea";besogo.GREY="#929591";besogo.GOLD="#dbb40c";besogo.TURQ="#06c2ac";besogo.svgEl=function(l,f){var k,n=document.createElementNS("http://www.w3.org/2000/svg",l);for(k in f||{})f.hasOwnProperty(k)&&n.setAttribute(k,f[k]);return n};besogo.svgStone=function(l,f,k){var n="besogo-svg-greyStone";-1===k?n="besogo-svg-blackStone":1===k&&(n="besogo-svg-whiteStone");return besogo.svgEl("circle",{cx:l,cy:f,r:42,"class":n})};
besogo.svgCircle=function(l,f,k){return besogo.svgEl("circle",{cx:l,cy:f,r:27,stroke:k,"stroke-width":8,fill:"none"})};besogo.svgSquare=function(l,f,k){return besogo.svgEl("rect",{x:l-23,y:f-23,width:46,height:46,stroke:k,"stroke-width":8,fill:"none"})};besogo.svgTriangle=function(l,f,k){return besogo.svgEl("polygon",{points:""+l+","+(f-30)+" "+(l-26)+","+(f+15)+" "+(l+26)+","+(f+15),stroke:k,"stroke-width":8,fill:"none"})};besogo.svgCross=function(l,f,k){return besogo.svgEl("path",{d:"m"+(l-24)+
","+(f-24)+"l48,48m0,-48l-48,48",stroke:k,"stroke-width":8,fill:"none"})};besogo.svgPlus=function(l,f,k){return besogo.svgEl("path",{d:"m"+l+","+(f-28)+"v56m-28,-28h56",stroke:k,"stroke-width":8,fill:"none"})};besogo.svgBlock=function(l,f,k){return besogo.svgEl("rect",{x:l-18,y:f-18,width:36,height:36,stroke:"none","stroke-width":8,fill:k})};besogo.svgLabel=function(l,f,k,n){var h;3<n.length&&(n=n.slice(0,2)+"\u2026");switch(n.length){case 1:h=72;break;case 2:h=56;break;case 3:h=36}l=besogo.svgEl("text",
{x:l,y:f,dy:".65ex","font-size":h,"text-anchor":"middle","font-family":"Helvetica, Arial, sans-serif",fill:k});l.appendChild(document.createTextNode(n));return l}})();
besogo.makeToolPanel=function(l,f){function k(a,b){var d=document.createElement("button"),g=besogo.svgEl("svg",{width:"100%",height:"100%",viewBox:"-55 -55 110 110"}),h=besogo.svgEl("rect",{x:-50,y:-50,width:100,height:100,fill:"none","stroke-width":8,stroke:besogo.GOLD,rx:20,ry:20,visibility:"hidden"});l.appendChild(d);d.appendChild(g);d.onclick=function(){f.setTool(a)};d.title=b;c[a]=h;g.appendChild(h);return g}function n(b){var d;b.label&&(a.value=b.label);if(b.tool)for(d in c)c.hasOwnProperty(d)&&
(b.tool===d?c[d].setAttribute("visibility","visible"):c[d].setAttribute("visibility","hidden"))}var h,b,a,c={},g=document.createElement("input"),d=document.createElement("input");b=k("auto","Auto-play/nav");b.appendChild(function(a,b){var c=besogo.svgEl("g");c.appendChild(besogo.svgEl("path",{d:"m"+a+","+(b-44)+" a44 44 0 0 1 0,88z",stroke:"none",fill:"black"}));c.appendChild(besogo.svgEl("path",{d:"m"+a+","+(b+44)+"a44 44 0 0 1 0,-88a22 22 0 0 1 0,44z",stroke:"none",fill:"white"}));c.appendChild(besogo.svgEl("circle",
{cx:a,cy:b+22,r:22,stroke:"none",fill:"black"}));return c}(0,0));b=k("playB","Play black");b.appendChild(besogo.svgStone(0,0,-1));b=k("playW","Play white");b.appendChild(besogo.svgStone(0,0,1));b=k("addB","Set black");h=besogo.svgEl("g");h.appendChild(besogo.svgStone(0,0,-1));h.appendChild(besogo.svgPlus(0,0,besogo.RED));b.appendChild(h);b=k("addW","Set white");h=besogo.svgEl("g");h.appendChild(besogo.svgStone(0,0,1));h.appendChild(besogo.svgPlus(0,0,besogo.RED));b.appendChild(h);b=k("addE","Set empty");
h=besogo.svgEl("g");h.appendChild(besogo.svgStone(0,0));h.appendChild(besogo.svgCross(0,0,besogo.RED));b.appendChild(h);b=k("circle","Circle");b.appendChild(besogo.svgCircle(0,0,"black"));b=k("square","Square");b.appendChild(besogo.svgSquare(0,0,"black"));b=k("triangle","Triangle");b.appendChild(besogo.svgTriangle(0,0,"black"));b=k("cross","Cross");b.appendChild(besogo.svgCross(0,0,"black"));b=k("block","Block");b.appendChild(besogo.svgBlock(0,0,"black"));b=k("clrMark","Clear mark");h=besogo.svgEl("g");
h.appendChild(besogo.svgTriangle(0,0,besogo.GREY));h.appendChild(besogo.svgCross(0,0,besogo.RED));b.appendChild(h);b=k("label","Label");b.appendChild(besogo.svgLabel(0,0,"black","A1"));a=document.createElement("input");a.type="text";a.title="Next label";a.onblur=function(){f.setLabel(a.value)};a.addEventListener("keydown",function(a){a=a||window.event;a.stopPropagation()});l.appendChild(a);g.type="button";g.value="Pass";g.title="Pass move";g.onclick=function(){var a=f.getTool();"navOnly"!==a&&"auto"!==
a&&"playB"!==a&&"playW"!==a&&f.setTool("auto");f.click(0,0,!1)};l.appendChild(g);d.type="button";d.value="Cut";d.title="Remove branch";d.onclick=function(){f.cutCurrent()};l.appendChild(d);f.addListener(n);n({label:f.getLabel(),tool:f.getTool()})};
besogo.makeTreePanel=function(l,f){function k(a){var b=l.clientWidth,c=l.clientHeight,d=l.scrollTop,e=l.scrollLeft,f=.25*(a.getAttribute("x")-5),g=.25*(a.getAttribute("y")-5);f<e?l.scrollLeft=f:f+30>e+b&&(l.scrollLeft=f+30-b);g<d?l.scrollTop=g:g+30>d+c&&(l.scrollTop=g+30-c);a.setAttribute("opacity",1);a.onmouseover=null;a.onmouseout=null;m.appendChild(a);r=a}function n(a){a.setAttribute("opacity",0);a.onmouseover=function(){a.setAttribute("opacity",.5)};a.onmouseout=function(){a.setAttribute("opacity",
0)};e.appendChild(a)}function h(){var a=f.getCurrent(),c=f.getRoot(),g=[],h=e,n=besogo.svgEl("rect",{height:"100%",width:"100%","class":"besogo-svg-board"});e=besogo.svgEl("svg");m=besogo.svgEl("g");q=besogo.svgEl("g");e.appendChild(n);e.appendChild(m);e.appendChild(q);c=b(c,0,0,g);q.appendChild(d(c,"black"));c=120*g.length;g=120*Math.max.apply(Math,g);e.setAttribute("viewBox","0 0 "+c+" "+g);e.setAttribute("height",.25*g);e.setAttribute("width",.25*c);h?l.replaceChild(e,h):l.appendChild(e);k(a.navTreeMarker)}
function b(f,h,k,l){var n=f.children,m,r,A;if(0===n.length)r="m"+(120*h+60)+","+(120*k+60);else for(m=l[h+1]||0,m=m<k?k:m,k<m-1&&(k=m-1),r=b(n[0],h+1,m,l)+g(h,k,l),A=1;A<n.length;A++)m=l[h+1],m=b(n[A],h+1,m,l)+g(h,k,l,m-1),q.appendChild(d(m,"black"));e.appendChild(a(f,h,k));c(f,h,k);l[h]=k+1;return r}function a(a,b,c){var d,e;switch(a.getType()){case "move":e=a.move.color;d=besogo.svgEl("g");d.appendChild(besogo.svgStone(120*b+60,120*c+60,e));d.appendChild(besogo.svgLabel(120*b+60,120*c+60,-1===e?
"white":"black",""+a.moveNumber));break;case "setup":d=besogo.svgEl("g");d.appendChild(besogo.svgStone(120*b+60,120*c+60));d.appendChild(besogo.svgPlus(120*b+60,120*c+60,besogo.RED));break;default:d=besogo.svgStone(120*b+60,120*c+60)}a.navTreeIcon=d;a.navTreeX=b;a.navTreeY=c;return d}function c(a,b,c){b=besogo.svgEl("rect",{x:120*b+60-55,y:120*c+60-55,width:110,height:110,fill:besogo.TURQ});b.onclick=function(){f.setCurrent(a)};a.navTreeMarker=b;n(b)}function g(a,b,c,d){a=c[a+1]-1;return a===b?"h-120":
a===b+1?"l-120,-120":d&&d!==b?"l-60,-60v-"+120*(a-d):"l-60,-60v-"+120*(a-b-1)+"l-60,-60"}function d(a,b){return besogo.svgEl("path",{d:a,stroke:b,"stroke-width":8,fill:"none"})}var e,q,m,r;h();f.addListener(function(a){a.treeChange?h():a.navChange&&(a=f.getCurrent(),n(r),k(a.navTreeMarker))})};